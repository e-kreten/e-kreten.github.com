<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>KRET√âN</title>
  <link rel="stylesheet" href="https://e-kreten.github.io/src/main_style.css">
</head>
<body>
<script>
    function login() {
        let username = document.getElementById("username_input").value;
        let password = document.getElementById("password_input").value;
        document.getElementById("logintxt").innerText = `SELECT * FROM users WHERE username = "${username}" AND password = "${password}"`;
        document.getElementById('loadingBox').style.display = 'block';

        setTimeout(() => {
          document.getElementById('loadingBox').style.display = 'none';

          setTimeout(() => {
            if (username == "admin" && password == "admin") {
                window.location.href = 'https://e-kreten.github.io/admin_panel'; 
            }
            else if (username == "createSmallLink") {
              document.getElementById("mklinkModal").style.display = "flex";
            }
            else {
              document.getElementById('failBox').style.display = 'block';
            }
          }, 100);

        }, 2000);
      }

function reset_pw() {
      document.getElementById("resetModal").style.display = "flex";
       }
function closeResetModal() {
      document.getElementById("resetModal").style.display = "none";
}
function closemklinkModal() {
      document.getElementById("mklinkModal").style.display = "none";
}
async function submitSmallLink() {
      let token = document.getElementById("password_input").value;
      let link = document.getElementById("link_input").value;
      let target = document.getElementById("target_link_input").value;
      document.getElementById("creatingLoader").style.display = "flex";
      if (!token || !link || !target) {
            alert("Fill out all fields");
          return;
      }

  const owner = "e-kreten";
  const repo = "e-kreten.github.com";
  const path = `share/${link}/index.html`;

  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  const htmlContent = `
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>KRET√âN - Hyperlink</title>
    <link rel="stylesheet" href="https://e-kreten.github.io/src/default_hyperlink_style.css">
</head>
<body>
    <div class="logo-header">
        <img src="https://e-kreten.github.io/src/logo.png" alt="KRET√âN Logo">
      </div>
        <div class="container">
            <div class="header" id="title">
                Hyperlink - Small Link
            </div>
            <div class="content">
            <p class="bold">Valaki Megosztott vele egy hossz√∫ linket<br>Az al√°bbi gombal ezt eltudja √©rni!</p>
           <div class="content2"> 
           <a href="${target}" target="_blank">
            <button class="button">Megosztott oldal megnyit√°sa</button>
            </a>
            </div>
            </div>
            </div>
          </div>
        </div>
        <footer>
            <p>
                <a href="https://github.com/e-kreten/e-kreten.github.io/" class="hyperlink">Az oldal forr√°sk√≥dja</a> &nbsp;&nbsp;‚Ä¢&nbsp;&nbsp;
                K√©sz√ºlt üçä megb√≠z√°s√°b√≥l, 12 Mrd ft k√∂zp√©nzb≈ël
            </p>
        </footer>
    </div>
</body>
</html>
  `.trim();

  // Encode content to base64
  const base64Content = btoa(unescape(encodeURIComponent(htmlContent)));

  // First, check if the file exists (to get the SHA)
  let sha = null;
  try {
    const res = await fetch(apiUrl, {
      headers: { Authorization: `token ${token}` }
    });
    if (res.ok) {
      const json = await res.json();
      sha = json.sha; // Required to update existing file
    }
  } catch (e) {
    console.log("Error checking file:", e);
  }

  // Now, PUT to create/update the file
  const response = await fetch(apiUrl, {
    method: "PUT",
    headers: {
      Authorization: `Token ${token}`,
    },
    body: JSON.stringify({
      message: `Create shared link: ${link}`,
      content: base64Content,
    })
  });

  const result = await response.json();

  if (response.ok) {
    document.getElementById('creatingLoader').style.display = 'none';
    document.getElementById('succCText').innerHTML = `A Link Sikeresen Elk√©sz√ºlt! Lehet hogy kell 1-2 percet f√°rnod m√©g m≈±k√∂dni fog a link!<br>https://e-kreten.github.io/share/${link}`;
    document.getElementById('succCBox').style.display = 'block';
    console.log(result);
  } else {
    resault.message
    document.getElementById('creatingLoader').style.display = 'none';
    document.getElementById('failCText').innerText = `A Linket nemsiker√ºlt elk√©sz√≠teni! ${result.message}`;
    document.getElementById('failCBox').style.display = 'block';
    console.error(result);
  }
}
</script>

<!-- Logo Header Section -->
<div class="logo-header">
    <img src="https://e-kreten.github.io/src/logo.png" alt="KRET√âN Logo">
  </div>

  <div class="container">
    <div class="header" id="title">
      Mit akarsz te kis ?
    </div>
    <div class="content">
        <p>K√©rj√ºk, adja meg az int√©zm√©nyi KRET√âN felhaszn√°l√≥nev√©t √©s jelszav√°t. Amennyiben elfelejtette, keresse meg valamelyik publikus adatb√°zisban</p>
        <p>Tisztelt <a href="#">R√≥bert');-- DROP TABLE Tanul√≥;</a>, technikai okok miatt lehets√©ges, hogy a rendszer n√©ha <em>(azaz soha)</em> nem m≈±k√∂dik.</p>
        <input type="text" placeholder="Felhaszn√°l√≥n√©v" id="username_input">
        <input type="password" placeholder="Jelsz√≥"id="password_input">
        <div class="loading-box" id="loadingBox">
          <p id="logintxt">SELECT * FROM users WHERE username = "" AND password = ""</p>
          <div class="spinner"></div>
        </div>
        <div class="fail-box" id="failBox">
          0 rows returned from database query.
        </div>
        <div class="action-row">
          <a onclick="reset_pw()">Elfelejtettem a jelszavam</a>
          <button class="button" onclick="login()">Bejelentkez√©s</button>
        </div>
  </div>
</div>

<!-- Modal -->
<div id="resetModal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
      <div class="modal-header">
        <span>Jelsz√≥ vissza√°ll√≠t√°s</span>
        <button onclick="closeResetModal()" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="loader"></div>
        <p>A jelsz√≥ helyre√°ll√≠t√°si k√©relm√©t feldolgoztuk, √©s a k√∂vetkez≈ë eredm√©nyre jutottunk:</p>
        <p style="color: red; font-weight: bold;">
          A KRET√âN nem tal√°lta √∂nt <a href="#" style="color: #00baff;">(R√≥bert');-- DROP TABLE Tanul√≥;)</a>+t el√©g fontosnak ahhoz, hogy foglalkozzon a probl√©m√°j√°val.
        </p>
        <p><strong>Javasolt megold√°sok:</strong></p>
        <ul>
          <li>Pr√≥b√°ld meg kital√°lni a jelszavad. Tippek: <strong>123456, password, admin, qwerty.</strong></li>
          <li>K√©rdezd meg az informatika tan√°rodat, ≈ë biztosan jobban eml√©kszik a jelszavadra, mint te.</li>
          <li>Kapcsold ki √©s be a g√©pedet.</li>
          <li>Haszn√°lj firk√°t. (legjobb opci√≥)</li>
          <li>Az is lehet, hogy a reFlic leakelt adatb√°zis√°ban lett elmentve a jelszavad, k√©rdezd meg Kim√°t is.</li>
        </ul>
        <p style="font-style: italic; color: gray;">Az √∫j jelsz√≥t elk√ºldt√ºk egy v√©letlenszer≈± e-mail c√≠mre, amit hasonl√≥nak v√©lt√ºnk a ti√©dhez.</p>
      </div>
    </div>
  </div>
   <!-- Modal -->
<div id="mklinkModal" class="modal-overlay" style="display:none;">
  <div class="modal-box">
    <div class="modal-header">
      <span>KRET√âN Small Link K√©sz√≠t√©s</span>
      <button onclick="closemklinkModal()" class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="loader" style="display:none;" id="creatingLoader"></div>
      <div class="success-box" style="display:none;" id="succCBox">
        <p id="succCText">A Link Sikeresen Elk√©sz√ºlt!</p>
      </div>
      <div class="fail-box" style="display:none;" id="failCBox">
        <p id="failCText">A Linket nemsiker√ºlt elk√©sz√≠teni!</p>
      </div>
      <p>Adja Meg a K√©sz√≠tend≈ë (Kis) Hyperlinket: https://e-kreten.github.io/share/</p><input type="text" placeholder="exampleLink"id="link_input">
      <p>Adja megy a Target (Hossz√∫) Linket: </p><input type="text" placeholder="Destination Link"id="target_link_input">
      <div class="content2">
      <button class="button" onclick="submitSmallLink()">Hyperlink K√©sz√≠t√©se</button>
    </div>  
    </div>
  </div>
</div>

  <div class="idkwhat">
    Ez az oldal kiz√°r√≥lag szatirikus c√©llal k√©sz√ºlt, semmilyen kapcsolatban nincs ez az eredeti e-kret√°val.<br>
    A bejelentkez√©si adatok nem az igazi KR√âTA-hoz tartoznak, hanem az oldal easter egg-jei.<br>
    <strong>Ne add meg a val√≥di KR√âTA bejelentkez√©si adataidat!</strong>
  </div>

  <!-- Embedded XML with words -->
  <script>
  fetch("https://e-kreten.github.io/src/DirtyWords.xml")
    .then(response => response.text())
    .then(str => (new DOMParser()).parseFromString(str, "text/xml"))
    .then(xml => {
      const words = Array.from(xml.getElementsByTagName('word')).map(el => el.textContent.trim());

      if (words.length >= 3) {
        const shuffled = words.sort(() => 0.5 - Math.random());
        const [w1, w2, w3] = shuffled;
        document.getElementById("title").innerText = `Mit akarsz te kis ${w1} ${w2} ${w3}?`;
      }
    })
    .catch(err => console.error("Failed to load XML:", err));
</script>
  <footer>
    <p>
        <a href="https://github.com/e-kreten/e-kreten.github.com" class="hyperlink">Az oldal forr√°sk√≥dja</a> &nbsp;&nbsp;‚Ä¢&nbsp;&nbsp;
        K√©sz√ºlt üçä megb√≠z√°s√°b√≥l, 12 Mrd ft k√∂zp√©nzb≈ël
    </p>
</footer>

</body>
</html>
